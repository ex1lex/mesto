(()=>{"use strict";var t=document.querySelector(".profile-container__add-button"),e=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__avatar-btn"),r=(document.querySelector(".gallery"),document.forms.addCardForm.querySelector(".dialog__submit")),o=document.forms.editProfileForm.querySelector(".dialog__submit"),i=document.forms.editAvatarForm.querySelector(".dialog__submit"),a=document.forms.deleteCardForm.querySelector(".dialog__submit"),s={formSelector:document.querySelector("#editProfileForm"),inputSelector:".dialog__input",submitButtonSelector:".dialog__submit",inactiveButtonClass:"dialog__submit_disabled",inputErrorClass:"dialog__input_error",errorClass:"dialog__error-label_show"},c={formSelector:document.querySelector("#editAvatarForm"),inputSelector:".dialog__input",submitButtonSelector:".dialog__submit",inactiveButtonClass:"dialog__submit_disabled",inputErrorClass:"dialog__input_error",errorClass:"dialog__error-label_show"},l={formSelector:document.querySelector("#addCardForm"),inputSelector:".dialog__input",submitButtonSelector:".dialog__submit",inactiveButtonClass:"dialog__submit_disabled",inputErrorClass:"dialog__input_error",errorClass:"dialog__error-label_show"};function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e,n,r,o,i,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cardSelector=n,this._handleCardClick=r,this._name=e.name,this._id=e._id,this._link=e.link,this._author=e.owner._id,this._likes=e.likes,this._deletePopup=o,this._getUserInfo=i,this._setLikeFunction=a,this._deleteLikeFunction=s}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}},{key:"_setLike",value:function(t){this._likeCount.textContent=t,this._like.classList.add("gallery__like_active")}},{key:"_deleteLike",value:function(t){this._likeCount.textContent=t>0?t:"",this._like.classList.remove("gallery__like_active")}},{key:"_likeClick",value:function(){var t=this;this._like.classList.contains("gallery__like_active")?this._deleteLikeFunction(this._id).then((function(e){t._deleteLike(e.likes.length)})):this._setLikeFunction(this._id).then((function(e){t._setLike(e.likes.length)}))}},{key:"_setEventListeners",value:function(){var t=this;this._element.querySelector(".gallery__trash").addEventListener("click",(function(){t._deletePopup.open((function(){t._element.remove()}),t._id)})),this._element.querySelector(".gallery__like").addEventListener("click",(function(){t._likeClick()})),this._element.querySelector(".gallery__img").addEventListener("click",(function(){t._handleCardClick(t._link,t._name)}))}},{key:"generateCard",value:function(){var t=this,e=this._getTemplate(),n=e.querySelector(".gallery__img"),r=e.querySelector(".gallery__title"),o=e.querySelector(".gallery__trash");return this._like=e.querySelector(".gallery__like"),this._likeCount=e.querySelector(".gallery__like-count"),n.src=this._link,n.alt=this._name,r.textContent=this._name,this._getUserInfo().then((function(e){e._id!=t._author&&o.remove(),t._likes.length>0&&(t._likeCount.textContent=t._likes.length),t._likes.forEach((function(n){n._id===e._id&&t._like.classList.add("gallery__like_active")}))})),this._element=e,this._setEventListeners(),this._element}}])&&u(e.prototype,n),t}();function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _=function(){function t(e,n){var r=e.items,o=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._items=r,this._renderer=o,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"renderItems",value:function(){var t=this;this._items.forEach((function(e){t._renderer(e)}))}},{key:"addItem",value:function(t){this._container.prepend(t)}}])&&h(e.prototype,n),t}();function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._btn=this._formSelector.querySelector(this._submitButtonSelector)}var e,n;return e=t,(n=[{key:"_toggleButtonState",value:function(t){this._hasInvalidInput(t)?(this._btn.classList.add(this._inactiveButtonClass),this._btn.disabled=!0):(this._btn.classList.remove(this._inactiveButtonClass),this._btn.disabled=!1)}},{key:"_showError",value:function(t){var e=this._formSelector.querySelector("#".concat(t.name,"Error"));t.classList.add(this._inputErrorClass),e.textContent=t.validationMessage,e.classList.add(this._errorClass)}},{key:"_hideError",value:function(t){var e=this._formSelector.querySelector("#".concat(t.name,"Error"));t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}},{key:"_hasInvalidInput",value:function(t){return t.some((function(t){return!t.validity.valid}))}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideError(t):this._showError(t)}},{key:"_setEventListeners",value:function(){var t=this;this._formSelector.addEventListener("submit",(function(t){t.preventDefault()})),this._toggleButtonState(this._inputList),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState(t._inputList)}))}))}},{key:"resetForm",value:function(t){var e=this;this._toggleButtonState(this._inputList),this._inputList.forEach((function(t){e._hideError(t),t.value=""})),t&&(this._btn.classList.remove(this._inactiveButtonClass),this._btn.disabled=!1)}},{key:"enableValidation",value:function(){this._inputList=Array.from(this._formSelector.querySelectorAll(this._inputSelector)),this._setEventListeners()}}])&&d(e.prototype,n),t}();function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popUp=document.querySelector(e),this._closeBtn=this._popUp.querySelector(".dialog__close-button"),this._handleEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popUp.classList.add("dialog_show"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popUp.classList.remove("dialog_show"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_closeByOverlay",value:function(t){(t.target.classList.contains("dialog")||t.target.classList.contains("dialog__form")||t.target.classList.contains("dialog__content-card"))&&this.close()}},{key:"_handleEscClose",value:function(t){t.preventDefault,this._popUp.classList.contains("dialog_show")&&"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._popUp.addEventListener("click",(function(e){t._closeByOverlay(e)})),this._closeBtn.addEventListener("click",(function(e){t.close()}))}}])&&p(e.prototype,n),t}();function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(r);if(o){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return S(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._img=document.querySelector(".dialog__img-card"),e._label=document.querySelector(".dialog__title-card"),e}return e=a,(n=[{key:"open",value:function(t,e){this._img.src=t,this._img.alt=e,this._label.textContent=e,g(w(a.prototype),"open",this).call(this)}}])&&b(e.prototype,n),a}(v);function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,e,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=q(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=q(r);if(o){var n=q(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return j(this,t)});function a(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,t))._formValidatorReset=n,r._form=document.querySelector(t).querySelector(".dialog__content"),r._handleFormSubmit=e,r._inputList=Array.from(r._form.querySelectorAll(".dialog__input")),r._submit=r._form.querySelector(".dialog__submit"),r}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"open",value:function(){O(q(a.prototype),"open",this).call(this),this._formValidatorReset()}},{key:"close",value:function(){O(q(a.prototype),"close",this).call(this),this._formValidatorReset()}},{key:"setInputsValues",value:function(t){this._inputList.forEach((function(e){e.value=t[e.name]||""}))}},{key:"setEventListeners",value:function(){var t=this;O(q(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t._submit.textContent="Сохранение...",t._handleFormSubmit(t._getInputValues()),t.close()}))}}])&&L(e.prototype,n),a}(v);function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e,n){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var F=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(r);if(o){var n=B(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return x(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._form=document.querySelector(t).querySelector(".dialog__content"),n._deleteCard=e,n._submit=n._form.querySelector(".dialog__submit"),n}return e=a,(n=[{key:"open",value:function(t,e){A(B(a.prototype),"open",this).call(this),this._remove=t,this._cardId=e}},{key:"setEventListeners",value:function(){var t=this;A(B(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t._submit.textContent="Удаление...",t._deleteCard(t._cardId).then((function(e){t._remove(),A(B(a.prototype),"close",t).call(t)}))}))}}])&&I(e.prototype,n),a}(v);function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var V=function(){function t(e){var n=e.selectorName,r=e.selectorAbout,o=e.selectorAvatar;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=document.querySelector(n),this._about=document.querySelector(r),this._avatar=document.querySelector(o)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return this._values={},this._values.inputName=this._name.textContent,this._values.inputAbout=this._about.textContent,this._values}},{key:"setUserInfo",value:function(t,e){this._name.textContent=t,this._about.textContent=e}},{key:"setUserAvatar",value:function(t){this._avatar.src=t}},{key:"getUserAvatar",value:function(){return this._values={},this._values.inputAbout=this._avatar.textContent,this._values}}])&&D(e.prototype,n),t}();function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var J=new(function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._baseUrl=e,this._token=n}var e,n;return e=t,(n=[{key:"_handleResponse",value:function(t){return t.ok?t.json():Promise.reject(new Error("Ошибка: ".concat(t.status)))}},{key:"catch",value:function(t){console.log(t)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"setUserAvatar",value:function(t){var e=t.inputNewImageUrl;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(this._handleResponse)}},{key:"setUserInfo",value:function(t){var e=t.inputName,n=t.inputAbout;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then(this._handleResponse)}},{key:"addNewCard",value:function(t,e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then(this._handleResponse)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._baseUrl,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"setLike",value:function(t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token}}).then(this._handleResponse)}},{key:"deleteLike",value:function(t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(this._handleResponse)}}])&&N(e.prototype,n),t}())("https://mesto.nomoreparties.co/v1/cohort-19","89348099-1c1a-4669-810a-e3803229c3b9"),H=new V({selectorName:".profile__title",selectorAbout:".profile__subtitle",selectorAvatar:".profile__avatar"}),M=new y(s);M.enableValidation();var $=new y(c);$.enableValidation();var G=new y(l);G.enableValidation();var K=function(t,e){t.textContent=e};Promise.all([J.getUserInfo(),J.getInitialCards()]).then((function(s){var c,l,u=(l=2,function(t){if(Array.isArray(t))return t}(c=s)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(c,l)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(c,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),h=u[0],d=u[1];H.setUserInfo(h.name,h.about),H.setUserAvatar(h.avatar);var y=new R(".dialog_edit-avatar",(function(t){J.setUserAvatar(t).then((function(t){H.setUserAvatar(t.avatar)})).catch(J.catch).finally((function(){K(i,"Сохранить")}))}),(function(){return $.resetForm(!1)}));y.setEventListeners(),n.addEventListener("click",(function(){y.open()}));var p=new R(".dialog_edit-profile",(function(t){J.setUserInfo(t).then((function(t){H.setUserInfo(t.name,t.about)})).catch(J.catch).finally((function(){dsetDefaultTextBtn(o,"Сохранить")}))}),(function(){return M.resetForm(!0)}));p.setEventListeners(),e.addEventListener("click",(function(){p.open(),p.setInputsValues(H.getUserInfo())}));var v=new C(".dialog_detail-card");v.setEventListeners();var m=new F(".dialog_delete-card",(function(t){return new Promise((function(e){J.deleteCard(t).then((function(t){e()}))})).catch(J.catch).finally((function(){K(a,"Да")}))}));m.setEventListeners();var b=function(t){var e=new f(t,"#card",(function(t,e){v.open(t,e)}),m,(function(){return new Promise((function(t){t(h)})).catch(J.catch)}),(function(t){return new Promise((function(e){J.setLike(t).then((function(t){e(t)}))})).catch(J.catch)}),(function(t){return new Promise((function(e){J.deleteLike(t).then((function(t){e(t)}))})).catch(J.catch)}));S.addItem(e.generateCard())},g=new R(".dialog_add-card",(function(t){J.addNewCard(t.inputTitle,t.inputImageUrl).then((function(t){b(t)})).catch(J.catch).finally((function(){K(r,"Сохранить")}))}),(function(){return G.resetForm(!1)}));g.setEventListeners(),t.addEventListener("click",(function(){g.open()}));var k=d.reverse(),S=new _({items:k,renderer:b},".gallery");S.renderItems()}))})();